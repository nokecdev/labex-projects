#-------------The process Overseer-------------
# List active system processes
ps aux

#Monitor process resource usage
top

Identify which processes are using a lot of resources
![alt img](./image.png)

#Identifying key processes
If you have the PID, you can use the following command:
ps -p 195 -o pid,ppid,cmd
This command lists the process and its associated ID and location
You can further narrow the search based on PID with pgrep.

#Terminate the process
pkill resource_hog.sh

Check:
ps aux | grep resource_hog

Run background process and write logs to process.log

nohup ./data_processor.sh > processor.log &
nohup = no hang up
This command writes from the data_processor script to the processor.log file in the background

#-------------The Network Navigator-------------
One of the web servers has stopped. We need to find out the network status and restore the connection.
First, we list the network interfaces with the ip command.

> ip addr
Result:
2: eth0: 1500 qdisc mq state UP group default qlen 1000 < BROADCAST,MULTICAST,UP,LOWER_UP > mtu
So there is an interface.

Does it have an IP?
Check it with: ifconfig. This is the content of the net-tools package.
# Expected output showing IP configuration
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500
inet 172.16.50.108 netmask 255.255.255.0 broadcast 172.16.50.255
ether 00:16:3e:04:b0:40 txqueuelen 1000 (Ethernet)

lo: flags=73<UP,LOOPBACK,RUNNING> mtu 65536
inet 127.0.0.1 netmask 255.0.0.0

Test the connection to the remote host:
ping 8.8.8.8 -c 4
There is a response, which means there is a problem with the application.

Is the application running and listening on the correct port?
To do this, we use ss (socket statistics command)
ss -tlnp | grep 8000
# Expected output showing a listening process on port 8000
LISTEN 0 5 0.0.0.0:8000 0.0.0.0:* users:(("python3",pid=3765,fd=3))

We checked everything, only one reason remains: firewall
Tasks:
Create a firewall that denies access on port 8000.
We add a firewall to allow incoming SSH connections (port 22)
Enable the new firewall

Deny port access:
sudo ufw deny 8000
Allow SSH:
sudo ufw allow ssh or ufw allow 22
Enable the firewall:
sudo ufw enable

#------------The Software Steward-------------
sudo apt install
sudo apt update

install a cli tool that displays system information visually
sudo apt install neofetch

Verify installation:
sudo apt show neofetch
dpkg -s: lists dependent packages too!

Remove obsolate packages if no longer needed to keep security
sudo apt remove figlet
Remove orphaned packages:
sudo apt autoremove

#------------The Backup Sentinel-------------
Only change the files you need, the important files are in the data, config and logs folders in this folder.
1.
Pack the files and compress them:
create a file: backup-list.txt
Append the lines to the file with echo:
echo -e "data\nconfig\nlogs" >> backup-list.txt
Here the -e parameter = interpretation which allows us to add new lines.

for backup we use the tar command and then compress it with gzip.
-T = read the objects to be copied from the file
-czf = create, compress, specify filename
-f = system-backup.tar.gz
-v = not used now, especially useful for large files if progress is needed

tar -T backup-list.txt -czf ./backups/system-backup.tar.gz

2. Verification
we list them in a backup-contents.txt file with the tar command.
This requires a .txt file
-t = list the list of an archive
-z = gzip
-v = detailed list
-f = specify the location of the backup file

This will write the contents of the backup compress to a txt file:
tar -tf ./backups/system-backup.tar.gz -zv >> backup-contents.txt

3. Restore from backup:
Scenario: the config/app.conf file was accidentally deleted, it needs to be restored from backup.
-x = specify the specific file
tar -xzf system-backup.tar.gz config/app.conf

4. Automatic backup with cron:
Open the cron editor:
crontab -e

The format for a cron job is: [minute] [hour] [day_of_month] [month] [day_of_week] [command]. * * * * * means every minute of every hour of every day.

* * * * * = every minute of every hour of every day
* * * * * tar -czf /home/project/backups/system-backup-$(date +\%Y-\%m-\%d_\%H-\%M-\%S).tar.gz -C /home/project .


------------------------
to create a backup from a folder
-----------------------
sudo tar -tzvf $(date +%Y-%m-%d).tar.gz /var/app
Ez létrehoz egy tar-t a jelenlegi dátummal

-----------
### Create zip files:
This command recursively creates a test_archive.zip folder from test_dir
zip -r test_archive.zip test_dir

To unzip:
unzip -d unzipped_files test_archive.zip

#--------------The Script Artisan-------------
Create automated shell scripts to manage numerous log files.
script is available in log_manager.sh


##---------------File and directory operations-----------------
Create nested directory structure
mkdir -p nested/structure/example
tree nested
nested
└── structure
    └── example

Rename or move file:
mv file1.txt renamed_file.txt

Move folder back with one directory:
cp -r nested dir1/
tree dir1
dir1
├── file1.txt
└── nested
    └── structure
        └── example

Search files in current directory and subdirectories:
find . -name "*.txt"

Search for files greater than 1MB:
find ~ -size +1M

Search for files that were modified in the last 24 hours:
find ~ -mtime -1

View two first line of a file:
head -n 2 multiline.txt

View last two line of a file:
tail -n 2 multiline.txt

##---------------Find a file and change its ownership and permissions-----------------
Feladat: A fájl valahol az /etc mappában lesz.
sudo find /etc/ -name "*sources.list*"
2 fájl-t talált:
/etc/apt/sources.list
/etc/apt/sources.list.d
Jog és ownership megváltoztatása:
sudo chown labex:labex /etc/apt/sources.list
sudo chmod 600 /etc/apt/sources.list 

## ---------------Grep command - Pattern searching-----------------
Search errors in server.log:
grep "ERROR" logs/server.log

Count errors:
grep -c "ERROR" logs/server.log

Case insensitive search:
grep -i "error" logs/server.log

Search for specific phrase in logs
grep "database connection failed" logs/*

Search with regex
grep "2023-[0-9][0-9]-[0-9][0-9]" logs/server.log

Search for lines where matches CRITICAL
-B 2 -A 2
Returns before 2 lines, and after 2 lines
grep -B 2 -A 2 "CRITICAL" logs/server.log

Inverted search. Returns lines that DOESN'T contain ERROR
grep -v "ERROR" logs/server.log


## -------------------- Text Processing ----------------

### tr command
Removes all 'o', 'h', 'l' letters from the 'hello labex' 
echo 'hello labex' | tr -d 'ohl'
----------
Squeeze letters, this command will print 'helo'
echo 'hello' | tr -s 'l'
----------
Convert text to uppercase. This command replaces letters from the first set to the second set. Prints out 'HELLO' as a result
echo 'hello' | tr '[:lower:]' '[:upper:]'
----------
Format text w col
cat -A /etc/protocols | head -n 10
cat /etc/protocols | col -x | cat -A | head -n 10
----------
Join files similiarly to database join operation
Join requires numbered lines in order to join the lines to each other.
Example:
echo -e "1 apple\n2 banana\n3 cherry" > fruits.txt
echo -e "1 red\n2 yellow\n3 red" > colors.txt
This two command creates two files with numbers
The join command matches them by numbers.
join fruits.txt colors.txt
Result:
1 apple red
2 banana yellow
3 cherry red
If no numbers, there might be unexpected error or no output at all.
----------
Paste command. It does not require a common field like numbers in the join command.
echo -e "apple\nbanana\ncherry" > fruits.txt
echo -e "red\nyellow\nred" > colors.txt
echo -e "sweet\nsweet\nsweet" > tastes.txt
It creates a table from the files:
apple   red     sweet
banana  yellow  sweet
cherry  red     sweet
By default paste uses tabulator but it can be defined with -d parameter.
It can also be serialized with -s parameter. So it prints out the following way:
apple   banana  cherry
red     yellow  red
sweet   sweet   sweet
It's useful in CSV files, logs, when needs to be combined.
----------


